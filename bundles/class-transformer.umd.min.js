!function(t,o){"object"==typeof exports&&"undefined"!=typeof module?o(exports):"function"==typeof define&&define.amd?define(["exports"],o):o((t="undefined"!=typeof globalThis?globalThis:t||self).ClassTransformer={})}(this,(function(t){"use strict";var o;t.TransformationType=void 0,(o=t.TransformationType||(t.TransformationType={}))[o.PLAIN_TO_CLASS=0]="PLAIN_TO_CLASS",o[o.CLASS_TO_PLAIN=1]="CLASS_TO_PLAIN",o[o.CLASS_TO_CLASS=2]="CLASS_TO_CLASS";var n=new(function(){function o(){this._typeMetadatas=new Map,this._transformMetadatas=new Map,this._exposeMetadatas=new Map,this._excludeMetadatas=new Map,this._ancestorsMap=new Map}return o.prototype.addTypeMetadata=function(t){this._typeMetadatas.has(t.target)||this._typeMetadatas.set(t.target,new Map),this._typeMetadatas.get(t.target).set(t.propertyName,t)},o.prototype.addTransformMetadata=function(t){this._transformMetadatas.has(t.target)||this._transformMetadatas.set(t.target,new Map),this._transformMetadatas.get(t.target).has(t.propertyName)||this._transformMetadatas.get(t.target).set(t.propertyName,[]),this._transformMetadatas.get(t.target).get(t.propertyName).push(t)},o.prototype.addExposeMetadata=function(t){this._exposeMetadatas.has(t.target)||this._exposeMetadatas.set(t.target,new Map),this._exposeMetadatas.get(t.target).set(t.propertyName,t)},o.prototype.addExcludeMetadata=function(t){this._excludeMetadatas.has(t.target)||this._excludeMetadatas.set(t.target,new Map),this._excludeMetadatas.get(t.target).set(t.propertyName,t)},o.prototype.findTransformMetadatas=function(o,n,e){return this.findMetadatas(this._transformMetadatas,o,n).filter((function(o){return!o.options||(!0===o.options.toClassOnly&&!0===o.options.toPlainOnly||(!0===o.options.toClassOnly?e===t.TransformationType.CLASS_TO_CLASS||e===t.TransformationType.PLAIN_TO_CLASS:!0!==o.options.toPlainOnly||e===t.TransformationType.CLASS_TO_PLAIN))}))},o.prototype.findExcludeMetadata=function(t,o){return this.findMetadata(this._excludeMetadatas,t,o)},o.prototype.findExposeMetadata=function(t,o){return this.findMetadata(this._exposeMetadatas,t,o)},o.prototype.findExposeMetadataByCustomName=function(t,o){return this.getExposedMetadatas(t).find((function(t){return t.options&&t.options.name===o}))},o.prototype.findTypeMetadata=function(t,o){return this.findMetadata(this._typeMetadatas,t,o)},o.prototype.getStrategy=function(t){var o=this._excludeMetadatas.get(t),n=o&&o.get(void 0),e=this._exposeMetadatas.get(t),r=e&&e.get(void 0);return n&&r||!n&&!r?"none":n?"excludeAll":"exposeAll"},o.prototype.getExposedMetadatas=function(t){return this.getMetadata(this._exposeMetadatas,t)},o.prototype.getExcludedMetadatas=function(t){return this.getMetadata(this._excludeMetadatas,t)},o.prototype.getExposedProperties=function(o,n){return this.getExposedMetadatas(o).filter((function(o){return!o.options||(!0===o.options.toClassOnly&&!0===o.options.toPlainOnly||(!0===o.options.toClassOnly?n===t.TransformationType.CLASS_TO_CLASS||n===t.TransformationType.PLAIN_TO_CLASS:!0!==o.options.toPlainOnly||n===t.TransformationType.CLASS_TO_PLAIN))})).map((function(t){return t.propertyName}))},o.prototype.getExcludedProperties=function(o,n){return this.getExcludedMetadatas(o).filter((function(o){return!o.options||(!0===o.options.toClassOnly&&!0===o.options.toPlainOnly||(!0===o.options.toClassOnly?n===t.TransformationType.CLASS_TO_CLASS||n===t.TransformationType.PLAIN_TO_CLASS:!0!==o.options.toPlainOnly||n===t.TransformationType.CLASS_TO_PLAIN))})).map((function(t){return t.propertyName}))},o.prototype.clear=function(){this._typeMetadatas.clear(),this._exposeMetadatas.clear(),this._excludeMetadatas.clear(),this._ancestorsMap.clear()},o.prototype.getMetadata=function(t,o){var n,e=t.get(o);e&&(n=Array.from(e.values()).filter((function(t){return void 0!==t.propertyName})));for(var r=[],i=0,a=this.getAncestors(o);i<a.length;i++){var s=a[i],p=t.get(s);if(p){var f=Array.from(p.values()).filter((function(t){return void 0!==t.propertyName}));r.push.apply(r,f)}}return r.concat(n||[])},o.prototype.findMetadata=function(t,o,n){var e=t.get(o);if(e){var r=e.get(n);if(r)return r}for(var i=0,a=this.getAncestors(o);i<a.length;i++){var s=a[i],p=t.get(s);if(p){var f=p.get(n);if(f)return f}}},o.prototype.findMetadatas=function(t,o,n){var e,r=t.get(o);r&&(e=r.get(n));for(var i=[],a=0,s=this.getAncestors(o);a<s.length;a++){var p=s[a],f=t.get(p);f&&f.has(n)&&i.push.apply(i,f.get(n))}return i.slice().reverse().concat((e||[]).slice().reverse())},o.prototype.getAncestors=function(t){if(!t)return[];if(!this._ancestorsMap.has(t)){for(var o=[],n=Object.getPrototypeOf(t.prototype.constructor);void 0!==n.prototype;n=Object.getPrototypeOf(n.prototype.constructor))o.push(n);this._ancestorsMap.set(t,o)}return this._ancestorsMap.get(t)},o}());var e=function(t,o,n){if(n||2===arguments.length)for(var e,r=0,i=o.length;r<i;r++)!e&&r in o||(e||(e=Array.prototype.slice.call(o,0,r)),e[r]=o[r]);return t.concat(e||Array.prototype.slice.call(o))};var r=function(){function o(t,o){this.transformationType=t,this.options=o,this.recursionStack=new Set}return o.prototype.transform=function(o,e,r,i,a,s){var p,f=this;if(void 0===s&&(s=0),Array.isArray(e)||e instanceof Set){var c=i&&this.transformationType===t.TransformationType.PLAIN_TO_CLASS?function(t){var o=new t;return o instanceof Set||"push"in o?o:[]}(i):[];return e.forEach((function(n,e){var i=o?o[e]:void 0;if(f.options.enableCircularCheck&&f.isCircular(n))f.transformationType===t.TransformationType.CLASS_TO_CLASS&&(c instanceof Set?c.add(n):c.push(n));else{var a=void 0;if("function"!=typeof r&&r&&r.options&&r.options.discriminator&&r.options.discriminator.property&&r.options.discriminator.subTypes){if(f.transformationType===t.TransformationType.PLAIN_TO_CLASS){a=r.options.discriminator.subTypes.find((function(t){return t.name===n[r.options.discriminator.property]}));var p={newObject:c,object:n,property:void 0},u=r.typeFunction(p);a=void 0===a?u:a.value,r.options.keepDiscriminatorProperty||delete n[r.options.discriminator.property]}if(f.transformationType===t.TransformationType.CLASS_TO_CLASS&&(a=n.constructor),f.transformationType===t.TransformationType.CLASS_TO_PLAIN)if(n[r.options.discriminator.property])a=r.options.discriminator.subTypes.find((function(t){return t.name===n[r.options.discriminator.property]})).value,n[r.options.discriminator.property]=r.options.discriminator.subTypes.find((function(t){return t.name===n[r.options.discriminator.property]})).name;else{p={newObject:c,object:n,property:void 0};n[r.options.discriminator.property]=r.typeFunction(p).name}}else a=r;var d=f.transform(i,n,a,void 0,n instanceof Map,s+1);c instanceof Set?c.add(d):c.push(d)}})),c}if(r!==String||a){if(r!==Number||a){if(r!==Boolean||a){if((r===Date||e instanceof Date)&&!a)return e instanceof Date?new Date(e.valueOf()):null==e?e:new Date(e);if(("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0).Buffer&&(r===Buffer||e instanceof Buffer)&&!a)return null==e?e:Buffer.from(e);if(null===(p=e)||"object"!=typeof p||"function"!=typeof p.then||a){if(a||null===e||"object"!=typeof e||"function"!=typeof e.then){if("object"==typeof e&&null!==e){r||e.constructor===Object||(Array.isArray(e)||e.constructor!==Array)&&(r=e.constructor),!r&&o&&(r=o.constructor),this.options.enableCircularCheck&&this.recursionStack.add(e);var u=this.getKeys(r,e,a),d=o||{};o||this.transformationType!==t.TransformationType.PLAIN_TO_CLASS&&this.transformationType!==t.TransformationType.CLASS_TO_CLASS||(d=a?new Map:r?new r:{});for(var y=function(i){if("__proto__"===i||"constructor"===i)return"continue";var p=i,f=i,c=i;if(!l.options.ignoreDecorators&&r)if(l.transformationType===t.TransformationType.PLAIN_TO_CLASS)(u=n.findExposeMetadataByCustomName(r,i))&&(c=u.propertyName,f=u.propertyName);else if(l.transformationType===t.TransformationType.CLASS_TO_PLAIN||l.transformationType===t.TransformationType.CLASS_TO_CLASS){var u;(u=n.findExposeMetadata(r,i))&&u.options&&u.options.name&&(f=u.options.name)}var y=void 0;y=l.transformationType===t.TransformationType.PLAIN_TO_CLASS?e[p]:e instanceof Map?e.get(p):e[p]instanceof Function?e[p]():e[p];var T=void 0,m=y instanceof Map;if(r&&a)T=r;else if(r){var v=n.findTypeMetadata(r,c);if(v){var h={newObject:d,object:e,property:c},S=v.typeFunction?v.typeFunction(h):v.reflectedType;v.options&&v.options.discriminator&&v.options.discriminator.property&&v.options.discriminator.subTypes?e[p]instanceof Array?T=v:(l.transformationType===t.TransformationType.PLAIN_TO_CLASS&&(T=void 0===(T=v.options.discriminator.subTypes.find((function(t){if(y&&y instanceof Object&&v.options.discriminator.property in y)return t.name===y[v.options.discriminator.property]})))?S:T.value,v.options.keepDiscriminatorProperty||y&&y instanceof Object&&v.options.discriminator.property in y&&delete y[v.options.discriminator.property]),l.transformationType===t.TransformationType.CLASS_TO_CLASS&&(T=y.constructor),l.transformationType===t.TransformationType.CLASS_TO_PLAIN&&(y[v.options.discriminator.property]?(T=v.options.discriminator.subTypes.find((function(t){return t.name===y[v.options.discriminator.property]})).value,y[v.options.discriminator.property]=v.options.discriminator.subTypes.find((function(t){return t.name===y[v.options.discriminator.property]})).name):y[v.options.discriminator.property]=T)):T=S,m=m||v.reflectedType===Map}else if(l.options.targetMaps)l.options.targetMaps.filter((function(t){return t.target===r&&!!t.properties[c]})).forEach((function(t){return T=t.properties[c]}));else if(l.options.enableImplicitConversion&&l.transformationType===t.TransformationType.PLAIN_TO_CLASS){var _=Reflect.getMetadata("design:type",r.prototype,c);_&&(T=_)}}var g=Array.isArray(e[p])?l.getReflectedType(r,c):void 0,A=o?o[p]:void 0;if(d.constructor.prototype){var M=Object.getOwnPropertyDescriptor(d.constructor.prototype,f);if((l.transformationType===t.TransformationType.PLAIN_TO_CLASS||l.transformationType===t.TransformationType.CLASS_TO_CLASS)&&(M&&!M.set||d[f]instanceof Function))return"continue"}if(l.options.enableCircularCheck&&l.isCircular(y)){if(l.transformationType===t.TransformationType.CLASS_TO_CLASS){L=y;(void 0!==(L=l.applyCustomTransformations(L,r,i,e,l.transformationType))||l.options.exposeUnsetFields)&&(d instanceof Map?d.set(f,L):d[f]=L)}}else{var C=l.transformationType===t.TransformationType.PLAIN_TO_CLASS?f:i,L=void 0;l.transformationType===t.TransformationType.CLASS_TO_PLAIN?(L=e[C],L=l.applyCustomTransformations(L,r,C,e,l.transformationType),L=e[C]===L?y:L,L=l.transform(A,L,T,g,m,s+1)):void 0===y&&l.options.exposeDefaultValues?L=d[f]:(L=l.transform(A,y,T,g,m,s+1),L=l.applyCustomTransformations(L,r,C,e,l.transformationType)),(void 0!==L||l.options.exposeUnsetFields)&&(d instanceof Map?d.set(f,L):d[f]=L)}},l=this,T=0,m=u;T<m.length;T++){y(m[T])}return this.options.enableCircularCheck&&this.recursionStack.delete(e),d}return e}return e}return new Promise((function(t,o){e.then((function(o){return t(f.transform(void 0,o,r,void 0,void 0,s+1))}),o)}))}return null==e?e:Boolean(e)}return null==e?e:Number(e)}return null==e?e:String(e)},o.prototype.applyCustomTransformations=function(t,o,e,r,i){var a=this,s=n.findTransformMetadatas(o,e,this.transformationType);return void 0!==this.options.version&&(s=s.filter((function(t){return!t.options||a.checkVersion(t.options.since,t.options.until)}))),(s=this.options.groups&&this.options.groups.length?s.filter((function(t){return!t.options||a.checkGroups(t.options.groups)})):s.filter((function(t){return!t.options||!t.options.groups||!t.options.groups.length}))).forEach((function(o){t=o.transformFn({value:t,key:e,obj:r,type:i,options:a.options})})),t},o.prototype.isCircular=function(t){return this.recursionStack.has(t)},o.prototype.getReflectedType=function(t,o){if(t){var e=n.findTypeMetadata(t,o);return e?e.reflectedType:void 0}},o.prototype.getKeys=function(o,r,i){var a=this,s=n.getStrategy(o);"none"===s&&(s=this.options.strategy||"exposeAll");var p=[];if(("exposeAll"===s||i)&&(p=r instanceof Map?Array.from(r.keys()):Object.keys(r)),i)return p;if(this.options.ignoreDecorators&&this.options.excludeExtraneousValues&&o){var f=n.getExposedProperties(o,this.transformationType),c=n.getExcludedProperties(o,this.transformationType);p=e(e([],f,!0),c,!0)}if(!this.options.ignoreDecorators&&o){f=n.getExposedProperties(o,this.transformationType);this.transformationType===t.TransformationType.PLAIN_TO_CLASS&&(f=f.map((function(t){var e=n.findExposeMetadata(o,t);return e&&e.options&&e.options.name?e.options.name:t}))),p=this.options.excludeExtraneousValues?f:p.concat(f);var u=n.getExcludedProperties(o,this.transformationType);u.length>0&&(p=p.filter((function(t){return!u.includes(t)}))),void 0!==this.options.version&&(p=p.filter((function(t){var e=n.findExposeMetadata(o,t);return!e||!e.options||a.checkVersion(e.options.since,e.options.until)}))),p=this.options.groups&&this.options.groups.length?p.filter((function(t){var e=n.findExposeMetadata(o,t);return!e||!e.options||a.checkGroups(e.options.groups)})):p.filter((function(t){var e=n.findExposeMetadata(o,t);return!(e&&e.options&&e.options.groups&&e.options.groups.length)}))}return this.options.excludePrefixes&&this.options.excludePrefixes.length&&(p=p.filter((function(t){return a.options.excludePrefixes.every((function(o){return t.substr(0,o.length)!==o}))}))),p=p.filter((function(t,o,n){return n.indexOf(t)===o}))},o.prototype.checkVersion=function(t,o){var n=!0;return n&&t&&(n=this.options.version>=t),n&&o&&(n=this.options.version<o),n},o.prototype.checkGroups=function(t){return!t||this.options.groups.some((function(o){return t.includes(o)}))},o}(),i={enableCircularCheck:!1,enableImplicitConversion:!1,excludeExtraneousValues:!1,excludePrefixes:void 0,exposeDefaultValues:!1,exposeUnsetFields:!0,groups:void 0,ignoreDecorators:!1,strategy:void 0,targetMaps:void 0,version:void 0},a=function(){return a=Object.assign||function(t){for(var o,n=1,e=arguments.length;n<e;n++)for(var r in o=arguments[n])Object.prototype.hasOwnProperty.call(o,r)&&(t[r]=o[r]);return t},a.apply(this,arguments)},s=function(){function o(){}return o.prototype.instanceToPlain=function(o,n){return new r(t.TransformationType.CLASS_TO_PLAIN,a(a({},i),n)).transform(void 0,o,void 0,void 0,void 0,void 0)},o.prototype.classToPlainFromExist=function(o,n,e){return new r(t.TransformationType.CLASS_TO_PLAIN,a(a({},i),e)).transform(n,o,void 0,void 0,void 0,void 0)},o.prototype.plainToInstance=function(o,n,e){return new r(t.TransformationType.PLAIN_TO_CLASS,a(a({},i),e)).transform(void 0,n,o,void 0,void 0,void 0)},o.prototype.plainToClassFromExist=function(o,n,e){return new r(t.TransformationType.PLAIN_TO_CLASS,a(a({},i),e)).transform(o,n,void 0,void 0,void 0,void 0)},o.prototype.instanceToInstance=function(o,n){return new r(t.TransformationType.CLASS_TO_CLASS,a(a({},i),n)).transform(void 0,o,void 0,void 0,void 0,void 0)},o.prototype.classToClassFromExist=function(o,n,e){return new r(t.TransformationType.CLASS_TO_CLASS,a(a({},i),e)).transform(n,o,void 0,void 0,void 0,void 0)},o.prototype.serialize=function(t,o){return JSON.stringify(this.instanceToPlain(t,o))},o.prototype.deserialize=function(t,o,n){var e=JSON.parse(o);return this.plainToInstance(t,e,n)},o.prototype.deserializeArray=function(t,o,n){var e=JSON.parse(o);return this.plainToInstance(t,e,n)},o}();var p=new s;t.ClassTransformer=s,t.Exclude=function(t){return void 0===t&&(t={}),function(o,e){n.addExcludeMetadata({target:o instanceof Function?o:o.constructor,propertyName:e,options:t})}},t.Expose=function(t){return void 0===t&&(t={}),function(o,e){n.addExposeMetadata({target:o instanceof Function?o:o.constructor,propertyName:e,options:t})}},t.Transform=function(t,o){return void 0===o&&(o={}),function(e,r){n.addTransformMetadata({target:e.constructor,propertyName:r,transformFn:t,options:o})}},t.TransformInstanceToInstance=function(t){return function(o,n,e){var r=new s,i=e.value;e.value=function(){for(var o=[],n=0;n<arguments.length;n++)o[n]=arguments[n];var e=i.apply(this,o),a=!!e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then;return a?e.then((function(o){return r.instanceToInstance(o,t)})):r.instanceToInstance(e,t)}}},t.TransformInstanceToPlain=function(t){return function(o,n,e){var r=new s,i=e.value;e.value=function(){for(var o=[],n=0;n<arguments.length;n++)o[n]=arguments[n];var e=i.apply(this,o),a=!!e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then;return a?e.then((function(o){return r.instanceToPlain(o,t)})):r.instanceToPlain(e,t)}}},t.TransformPlainToInstance=function(t,o){return function(n,e,r){var i=new s,a=r.value;r.value=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var r=a.apply(this,n),s=!!r&&("object"==typeof r||"function"==typeof r)&&"function"==typeof r.then;return s?r.then((function(n){return i.plainToInstance(t,n,o)})):i.plainToInstance(t,r,o)}}},t.Type=function(t,o){return void 0===o&&(o={}),function(e,r){var i=Reflect.getMetadata("design:type",e,r);n.addTypeMetadata({target:e.constructor,propertyName:r,reflectedType:i,typeFunction:t,options:o})}},t.classToClassFromExist=function(t,o,n){return p.classToClassFromExist(t,o,n)},t.classToPlain=function(t,o){return p.instanceToPlain(t,o)},t.classToPlainFromExist=function(t,o,n){return p.classToPlainFromExist(t,o,n)},t.deserialize=function(t,o,n){return p.deserialize(t,o,n)},t.deserializeArray=function(t,o,n){return p.deserializeArray(t,o,n)},t.instanceToInstance=function(t,o){return p.instanceToInstance(t,o)},t.instanceToPlain=function(t,o){return p.instanceToPlain(t,o)},t.plainToClass=function(t,o,n){return p.plainToInstance(t,o,n)},t.plainToClassFromExist=function(t,o,n){return p.plainToClassFromExist(t,o,n)},t.plainToInstance=function(t,o,n){return p.plainToInstance(t,o,n)},t.serialize=function(t,o){return p.serialize(t,o)},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=class-transformer.umd.min.js.map
